{% extends "students/base.html" %} {% load student_extras %} {% block content %}
<div class="flex justify-between items-center mb-4">
  <h2 class="text-xl font-semibold">Students</h2>
  <div class="flex items-center gap-4">
    <form method="get" class="flex items-center gap-2">
      <label class="text-sm text-gray-700">Date:</label>
      <input
        type="date"
        name="date"
        value="{{ selected_date }}"
        class="border rounded px-2 py-1"
      />
      <button class="bg-slate-600 text-white px-3 py-1 rounded">Apply</button>
    </form>
    <a
      href="{% url 'student_create' %}"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg"
    >
      + Add Student
    </a>
  </div>
</div>

<table class="min-w-full bg-white shadow rounded-xl overflow-hidden">
  <thead class="bg-slate-200">
    <tr>
      <th class="px-4 py-2 text-left">Roll No</th>
      <th class="px-4 py-2 text-left">Name</th>
      <th class="px-4 py-2 text-left">Email</th>
      <th class="px-4 py-2 text-left">Class</th>
      <th class="px-4 py-2 text-left">Status ({{ selected_date }})</th>
      <th class="px-4 py-2 text-left">Attendance</th>
      <th class="px-4 py-2 text-left">Marks</th>
    </tr>
  </thead>
  <tbody>
    {% for s in students %}
    <tr class="border-t">
      <td class="px-4 py-2">{{ s.rollNumber }}</td>
      <td class="px-4 py-2">{{ s.firstName }} {{ s.lastName }}</td>
      <td class="px-4 py-2">{{ s.email }}</td>
      <td class="px-4 py-2">{{ s.className }}</td>
      <td class="px-4 py-2">{{ att_status|get_item:s.id|default:"-" }}</td>
      <td class="px-4 py-2">
        <form
          method="post"
          action="{% url 'attendance_mark' %}"
          class="flex items-center gap-2"
        >
          {% csrf_token %}
          <input type="hidden" name="studentId" value="{{ s.id }}" />
          <input
            type="date"
            name="date"
            value="{{ selected_date|default:today }}"
            class="border rounded px-2 py-1"
            required
          />
          <label class="inline-flex items-center gap-1 text-sm"
            ><input type="radio" name="status" value="Present" checked />
            Present</label
          >
          <label class="inline-flex items-center gap-1 text-sm"
            ><input type="radio" name="status" value="Absent" /> Absent</label
          >
          <button class="bg-blue-600 text-white px-3 py-1 rounded">Save</button>
        </form>
      </td>
      <td class="px-4 py-2">
        <a
          href="{% url 'marks_add' %}?student_id={{ s.id }}"
          class="bg-emerald-600 text-white px-3 py-1 rounded"
          >Add Marks</a
        >
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7" class="px-4 py-4 text-center text-gray-500">
        No students yet.
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
